
{% macro chart_timeline(timeline) -%}
    <div class="chart-timeline">
        {% set max_count = timeline | map('last') | max %}
        <div class="chart-timeline-bars">
            {% for (start_time, end_time), count in timeline %}
                <a href="datasets?after={{ start_time }}&before={{ end_time }}"
                   class="chart-timeline-bar {% if start_time.month == 1 %}new-year{% endif %}"
                   style="height: {{ (count or 0)/(max_count if max_count > 0 else 1)*100 }}%"
                   title="View the {{ count }} datasets for {{ start_time.month | month_name }} {{ start_time.year }}"></a>
            {% endfor %}
        </div>
        <div class="chart-timeline-years">
            {% for group in timeline | groupby('0.begin.year') %}
                <span class="chart-timeline-year">{{ group.grouper }}</span>
            {% endfor %}
        </div>
    </div>
{%- endmacro %}

{% macro query_param_list(d) -%}
    {% for key, value in d | dictsort if value is not mapping %}
        <div class="query-param">
            <span class="key">{{ key }}:</span>
            <span class="value">{{ value | query_value }}</span>
        </div>
    {% endfor %}
{%- endmacro %}