{% extends "layout/base.html" %}

{% block title %}{{ dataset | printable_dataset }}{% endblock %}
{% block head %}
    {{ super() }}
    <style type="text/css">
        .property {
            font-family: 'Courier New', monospace;
            line-height: 1.3em;
        }

        .property .property {
            padding-left: 15px;
        }

        .embedded > .property > .key {
            font-weight: bold;

        }

        .file-path {
            font-family: 'Courier New', monospace;
            font-size: 0.86em;
        }

        .raw-metadata {
            overflow-y: scroll;
            max-height: 600px;
        }
    </style>
{% endblock %}
{% block panel %}

{% endblock %}
{% block content %}
    <div class="panel highlight">
        <h2>{{ dataset | printable_dataset }}</h2>
        Indexed by <strong>{{ dataset.indexed_by }}</strong> <span
            title="{{ dataset.indexed_time }}">{{ dataset.indexed_time | timesince }}</span>
        {% if dataset.archived_time %}
            <div>
                Archived
                <span title="{{ dataset.archived_time }}">
                    {{ dataset.archived_time | timesince }}
                </span>
            </div>
        {% endif %}
        <div>
            {{ dataset.type.name }} ({{ dataset.type.metadata_type.name }})
        </div>
    </div>
    {% if source_datasets %}
        <div class="panel">
            <div class="sources">
                {% for classifier, s_dataset in source_datasets.items() %}
                    <div class="source">
                        Source <em>{{ classifier }}</em>:
                        <a href="{{ url_for('dataset.dataset_page', id_=s_dataset.id) }}">{{ s_dataset | printable_dataset }}</a>
                    </div>
                {% endfor %}
            </div>
        </div>
    {% endif %}
    <div class="panel odd">
        <h2>Fields</h2>
        {% from "layout/macros.html" import query_param_list %}
        {{ query_param_list(dataset.metadata.fields) }}
    </div>
    <div class="panel">

        {% for uri in dataset.uris %}
            <p>
                <b>Active:</b> <span class="file-path">{{ uri }}</span>
            </p>
        {% else %}
            No known locations
        {% endfor %}

        {% if archive_location_times %}
            {% for uri, archive_time in archive_location_times %}
                <p>
                    <b>Archived {{ archive_time | timesince }}:</b>
                    <span class="file-path archived">{{ uri }}</span>
                </p>
            {% endfor %}
        {% endif %}
    </div>
    <div class="panel odd">
        <h2>Raw Metadata</h2>
        <div class="raw-metadata">
            {%- for key, value in dataset_metadata.items() recursive %}
                <div class="property">
                    {% if value is mapping %}
                        <div class="key">{{ key }}:</div>
                        <div class="value {% if key == 'source_datasets' %}embedded{% endif %}">
                            {{ loop(value.items()) }}
                        </div>
                    {% else %}
                        <span class="key">{{ key }}:</span>
                        <span class="value">{{ value }}</span>
                    {% endif %}
                </div>
            {%- endfor %}
        </div>
    </div>
    {% if derived_datasets %}
        <div class="panel">
            <h2>Derived</h2>
            {% for d_dataset in derived_datasets %}
                <div>
                    <a href="{{ url_for('dataset.dataset_page', id_=d_dataset.id) }}">{{ d_dataset | printable_dataset }}</a>
                </div>
            {% endfor %}
        </div>
    {% endif %}
{% endblock %}
