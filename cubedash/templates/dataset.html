{% extends "layout/base.html" %}

{% block title %}{{ dataset | printable_dataset }}{% endblock %}
{% block head %}
    {{ super() }}
    <style type="text/css">
        .sub-header {
            line-height: 1.4em;
        }

        .tree-node {
            margin-left: 30px;
        }

        .dataset-location + .dataset-location {
            margin-top: 15px;
        }

        .file-path {
            font-family: monospace;
            font-size: 12px;
        }
    </style>
{% endblock %}
{% block panel %}

{% endblock %}
{% block content %}
    {% from "layout/macros.html" import query_param_list, show_raw_document %}
    <div class="panel highlight">
        <h2>{{ dataset | printable_dataset }}</h2>
        <div class="sub-header">
            Indexed by <strong>{{ dataset.indexed_by }}</strong>
            {{ dataset.indexed_time | timesince }}
            {% if dataset.archived_time %}
                <div>
                    Archived
                    <span title="{{ dataset.archived_time }}">
                    {{ dataset.archived_time | timesince }}
                    </span>
                </div>
            {% endif %}
        </div>
        <div class="sub-header">
            {{ dataset.type.name }} ({{ dataset.type.metadata_type.name }})
        </div>
    </div>
    <div class="panel">
        {% for classifier, s_dataset in source_datasets.items() %}
            <div>
                <span title="Source '{{ classifier }}'">
                    ðŸ¡‘ <a href="{{ url_for('dataset.dataset_page', id_=s_dataset.id) }}">{{ s_dataset | printable_dataset }}</a>
                </span>
            </div>
        {% endfor %}
        <div class="tree-node">
            â†’ <strong>{{ dataset | printable_dataset }}</strong>
            {% for d_dataset in derived_datasets %}
                <div class="tree-node">
                    <span title="Derived {{ d_dataset.type.name }}">
                        â¤· <a href="{{ url_for('dataset.dataset_page', id_=d_dataset.id) }}">
                            {{ d_dataset | printable_dataset }}
                        </a>
                    </span>
                </div>
            {% endfor %}
        </div>

    </div>
    <div class="panel odd">
        <h2>Fields</h2>
        {{ query_param_list(dataset.metadata.fields, wide=true, show_dicts=false) }}
    </div>
    <div class="panel">
        <h2>Locations</h2>
        {% for uri in dataset.uris %}
            <div class="dataset-location">
                <div><strong>Active:</strong></div>
                <span class="file-path">{{ uri }}</span>
            </div>
        {% else %}
            No known active locations
        {% endfor %}

        {% if archive_location_times %}
            {% for uri, archive_time in archive_location_times %}
                <div class="dataset-location">
                    <div><strong>Archived {{ archive_time | timesince }}:</strong></div>
                    <span class="file-path archived">{{ uri }}</span>
                </div>
            {% endfor %}
        {% endif %}
    </div>
    <div class="panel odd">
        <h2>Raw Metadata</h2>
        {{ show_raw_document(dataset_metadata) }}
    </div>
{% endblock %}
